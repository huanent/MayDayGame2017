var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},MusicPlayer=function(){function e(){var e=this;this.isFirst=!0,this.music=new egret.Sound,this.music.load("/resource/assets/bg.mp3"),this.music.addEventListener(egret.Event.COMPLETE,function(){e.canPlay=!0},this)}return e.prototype.play=function(){this.canPlay&&(this.ctrl=this.music.play(0,0),this.isplay=!0,this.isFirst=!1)},e.prototype.stop=function(){this.ctrl.stop(),this.isplay=!1},e}();__reflect(MusicPlayer.prototype,"MusicPlayer");var GameOverEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t}(egret.Event);GameOverEvent.NAME="GameOverEvent",__reflect(GameOverEvent.prototype,"GameOverEvent");var AlignHelpers=function(){function e(){}return e.rightAlign=function(e,t){if(void 0===t&&(t=AlignContainer.parent),e.parent){var n=t==AlignContainer.parent?e.parent.width:this.stageWidth;e.x=n-e.width}},e.bottomAlign=function(e,t){if(void 0===t&&(t=AlignContainer.parent),e.parent){var n=t==AlignContainer.parent?e.parent.height:this.stageHeight;e.y=n-e.height}},e.centerX=function(e,t){void 0===t&&(t=AlignContainer.parent),this.rightAlign(e,t),e.x=e.x/2},e.centerY=function(e,t){void 0===t&&(t=AlignContainer.parent),this.bottomAlign(e,t),e.y=e.y/2},e.centerObj=function(e,t){void 0===t&&(t=AlignContainer.parent),this.centerX(e,t),this.centerY(e,t)},e}();__reflect(AlignHelpers.prototype,"AlignHelpers");var Helpers=function(){function e(){}return e.getRandomNum=function(e,t){return t++,Math.floor(e+Math.random()*(t-e))},e}();__reflect(Helpers.prototype,"Helpers");var RESHelpers=function(){function e(){}return e.createImg=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=new egret.Bitmap(RES.getRes(e));return i.visible=!1,t&&(i.width=t),n&&(i.height=n),i},e.createTxt=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=new egret.TextField;return i.visible=!1,t&&(i.textColor=t),n&&(i.backgroundColor=n),i.text=e,i},e.createShape=function(e,t,n,i,r,o){var s=new egret.Shape;return s.graphics.beginFill(r,o),s.graphics.drawRect(e,t,n,i),s.graphics.endFill(),s},e.addToParent=function(e,t,n,i,r){switch(void 0===n&&(n=Align.left),void 0===i&&(i=AlignContainer.parent),void 0===r&&(r=null),e.addChild(t),n){case Align.right:AlignHelpers.rightAlign(t,i);break;case Align.rightCenterY:AlignHelpers.rightAlign(t,i),AlignHelpers.centerY(t,i);break;case Align.bottomCenter:AlignHelpers.bottomAlign(t,i),AlignHelpers.centerX(t,i);break;case Align.bottomLeft:AlignHelpers.bottomAlign(t,i);break;case Align.bottomRight:AlignHelpers.bottomAlign(t,i),AlignHelpers.rightAlign(t,i);break;case Align.center:AlignHelpers.centerObj(t,i);break;case Align.centerX:AlignHelpers.centerX(t,i);break;case Align.centerY:AlignHelpers.centerY(t,i)}r&&r(t),t.visible=!0},e}();__reflect(RESHelpers.prototype,"RESHelpers");var StaticData=function(){function e(){}return e}();StaticData.url="http://192.168.1.223:11000",__reflect(StaticData.prototype,"StaticData");var Main=function(e){function t(){var t=e.call(this)||this;return t.isFirst=!0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene(),this.welcomeUI.enableBeginGameTap())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.createGameScene=function(){AlignHelpers.stageWidth=this.stage.stageWidth,AlignHelpers.stageHeight=this.stage.stageHeight,this.music||(this.music=new MusicPlayer),this.addWelcomeUI()},t.prototype.addWelcomeUI=function(){var t=this,n=this.welcomeUI=new WelcomeUI(this.music);this.addChild(n),this.isFirst?(RES.loadGroup("game"),this.isFirst=!1):this.welcomeUI.enableBeginGameTap(),n.addEventListener(WindowCloseEvent.NAME,function(){e.prototype.removeChild.call(t,n),t.addGameUI()},this)},t.prototype.addGameUI=function(){this.gameUI=new GameUI(this.music),e.prototype.addChild.call(this,this.gameUI),this.gameUI.addEventListener(GameOverEvent.NAME,this.onGameOver,this)},t.prototype.onGameOver=function(t){var n=this;this.gameOverUI=new GameOverUI(t.time),e.prototype.addChild.call(this,this.gameOverUI),this.gameOverUI.addEventListener(WindowCloseEvent.NAME,function(){e.prototype.removeChild.call(n,n.gameUI),e.prototype.removeChild.call(n,n.gameOverUI),n.addWelcomeUI()},this)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Align;!function(e){e[e.left=0]="left",e[e.right=1]="right",e[e.centerX=2]="centerX",e[e.centerY=3]="centerY",e[e.rightCenterY=4]="rightCenterY",e[e.center=5]="center",e[e.bottomLeft=6]="bottomLeft",e[e.bottomRight=7]="bottomRight",e[e.bottomCenter=8]="bottomCenter"}(Align||(Align={}));var AlignContainer;!function(e){e[e.parent=0]="parent",e[e.stage=1]="stage"}(AlignContainer||(AlignContainer={}));var WindowCloseEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t}(egret.Event);WindowCloseEvent.NAME="WindowCloseEvent",__reflect(WindowCloseEvent.prototype,"WindowCloseEvent");var Point=function(){function e(e,t){this.x=e,this.y=t}return e}();__reflect(Point.prototype,"Point");var BarUI=function(e){function t(t){var n=e.call(this)||this;return n.music=t,n.createView(),n}return __extends(t,e),t.prototype.createView=function(){var e=this,t=this.timeTxt=RESHelpers.createTxt("0.0");t.size=60,RESHelpers.addToParent(this,t,Align.centerX,AlignContainer.stage,function(){t.y+=50});var n=RESHelpers.createImg("music-_close-@2x_png");RESHelpers.addToParent(this,n,Align.right,null,function(){n.y+=75,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.touchEnabled=!0});var i=RESHelpers.createImg("music-@2x_png");RESHelpers.addToParent(this,i,Align.right,null,function(){i.y+=75,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.touchEnabled=!0}),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.music.play(),n.visible=!1,i.visible=!0},this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.music.stop(),i.visible=!1,n.visible=!0},this),this.music.isFirst?(this.music.isFirst=!1,n.visible=!1):this.music.isplay?n.visible=!1:i.visible=!1;var r=new egret.Timer(30,0);r.addEventListener(egret.TimerEvent.TIMER,function(){i.rotation=++i.rotation%360},this),r.start()},t.prototype.setTime=function(e){var t=this.timeTxt;t.text=e.toFixed(1)},t}(egret.Sprite);__reflect(BarUI.prototype,"BarUI");var EnemyUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){var e=this;this.enemy=RESHelpers.createImg("enemy_png"),RESHelpers.addToParent(this,this.enemy),this.enemy2=RESHelpers.createImg("enemy2_png"),RESHelpers.addToParent(this,this.enemy2),this.enemy2.visible=!1,this.timer=new egret.Timer(100,0),this.timer.addEventListener(egret.TimerEvent.TIMER,function(){e.enemy.visible=!e.enemy.visible,e.enemy2.visible=!e.enemy2.visible},this),this.timer.start()},t.prototype.slip=function(e,t){this.timer.stop(),this.removeChild(this.enemy),this.removeChild(this.enemy2);var n=RESHelpers.createImg("nv3_png"),i=t*t*90/(t*t+e*e);0==e&&t>0?i=90:0==e&&0>t?i=270:e>0&&0==t?i=90:0>e&&0==t?i=270:e>0&&t>0?i+=90:0>e&&0>t?i+=270:0>e&&t>0?i+=180:e>0&&t>0&&(i+=90),n.anchorOffsetX+=n.width/2,n.anchorOffsetY+=n.height/2,n.x+=n.width/2,n.y+=n.height/2,n.rotation=i,RESHelpers.addToParent(this,n)},t}(egret.Sprite);__reflect(EnemyUI.prototype,"EnemyUI");var GameOverUI=function(e){function t(t){var n=e.call(this)||this;return n.time=t,n.createView(),n}return __extends(t,e),t.prototype.createView=function(){this.addBg(),this.addWindow(),this.addRestartBtn(),this.addCardBtn(),this.addMark()},t.prototype.addBg=function(){var e=RESHelpers.createShape(0,0,AlignHelpers.stageWidth,AlignHelpers.stageHeight,0,.8);RESHelpers.addToParent(this,e),e.touchEnabled=!0},t.prototype.addWindow=function(){var e;e=10<this.time&&this.time<=30?RESHelpers.createImg("window1_png"):30<this.time&&this.time<=60?RESHelpers.createImg("window2_png"):60<this.time?RESHelpers.createImg("window3_png"):RESHelpers.createImg("window1_png"),RESHelpers.addToParent(this,e,Align.center,AlignContainer.stage)},t.prototype.addRestartBtn=function(){var e=this,t=RESHelpers.createImg("restart_btn_png");RESHelpers.addToParent(this,t,Align.center,AlignContainer.stage,function(){t.y+=150,t.x-=150}),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.dispatchEvent(new WindowCloseEvent(WindowCloseEvent.NAME))},this)},t.prototype.addCardBtn=function(){var e=RESHelpers.createImg("btn_jiangli@2x_png");RESHelpers.addToParent(this,e,Align.center,AlignContainer.stage,function(){e.y+=150,e.x+=150}),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)},t.prototype.addMark=function(){var e=this.time/60,t=this.time%60,n=RESHelpers.createTxt(Math.floor(e)+" : "+Math.floor(t));RESHelpers.addToParent(this,n,Align.center,null,function(){n.y-=65,n.x-=25,n.size=50,n.textColor=16757760})},t}(egret.Sprite);__reflect(GameOverUI.prototype,"GameOverUI");var GameUI=function(e){function t(t){var n=e.call(this)||this;return n.music=t,n.passTime=0,n.enemys=new Array,n.timers=new Array,n.createView(),n}return __extends(t,e),t.prototype.createView=function(){this.addBg(),this.addMonk(),this.addCloud(),this.addBar(),this.addEnemyTimer(),this.addEnemyAction()},t.prototype.addBg=function(){var t=this.bg=RESHelpers.createShape(0,0,AlignHelpers.stageWidth,AlignHelpers.stageHeight,0,0);e.prototype.addChild.call(this,t);var n=this.bg1=RESHelpers.createImg("game_bg_png",AlignHelpers.stageWidth),i=this.bg2=RESHelpers.createImg("game_bg_png",AlignHelpers.stageWidth);RESHelpers.addToParent(this,n),e.prototype.swapChildren.call(this,t,n),i.y=1155,RESHelpers.addToParent(this,i),e.prototype.swapChildren.call(this,t,i);var r=new egret.Timer(30,0);r.addEventListener(egret.TimerEvent.TIMER,function(){i.y>=1155&&(i.y=-1155),n.y>=1155&&(n.y=-1155),n.y+=1,i.y+=1},this),r.start()},t.prototype.addMonk=function(){var e=this.monk=new MonkUI,t=this.bg;RESHelpers.addToParent(this,e,Align.bottomCenter,null,function(){e.y-=100}),t.touchEnabled=!0;var n=function(t){var n=t.stageX-e.x-e.width/2,i=t.stageY-e.y- -e.height/2,r=Math.sqrt(n*n+i*i);egret.Tween.get(e).to({x:t.stageX-e.width/2,y:t.stageY-e.height/2},r/3)};t.addEventListener(egret.TouchEvent.TOUCH_MOVE,n,this),t.addEventListener(egret.TouchEvent.TOUCH_TAP,n,this)},t.prototype.addCloud=function(){var t=this,n=RESHelpers.createImg("yun-small_png",AlignHelpers.stageWidth);n.y=-230,e.prototype.addChild.call(this,n),n.visible=!0,e.prototype.setChildIndex.call(this,n,this.getChildIndex(this.monk)-1),egret.Tween.get(n).to({y:2e3},13e3).call(function(){e.prototype.removeChild.call(t,n)});var i=RESHelpers.createImg("yun-small_png",AlignHelpers.stageWidth);i.y=236,e.prototype.addChild.call(this,i),i.visible=!0,e.prototype.setChildIndex.call(this,i,this.getChildIndex(this.monk)-1),egret.Tween.get(i).to({y:2466},13e3).call(function(){e.prototype.removeChild.call(t,i)});var r=RESHelpers.createImg("yun-small_png",AlignHelpers.stageWidth);r.y=676,e.prototype.addChild.call(this,r),r.visible=!0,e.prototype.setChildIndex.call(this,r,this.getChildIndex(this.monk)-1),egret.Tween.get(r).to({y:2906},13e3).call(function(){e.prototype.removeChild.call(t,r)});var o=new egret.Timer(2e3,0);o.addEventListener(egret.TimerEvent.TIMER,function(){var n=RESHelpers.createImg("yun-small_png",AlignHelpers.stageWidth);n.y-=n.height,e.prototype.addChild.call(t,n),n.visible=!0,e.prototype.setChildIndex.call(t,n,t.getChildIndex(t.monk)-1),egret.Tween.get(n).to({y:2e3},13e3).call(function(){e.prototype.removeChild.call(t,n)})},this),o.start()},t.prototype.addBar=function(){var e=this,t=this.barUI=new BarUI(this.music);RESHelpers.addToParent(this,t);var n=new egret.Timer(100,0);n.addEventListener(egret.TimerEvent.TIMER,function(){e.passTime+=.1,t.setTime(e.passTime)},this),this.timers.push(n),n.start()},t.prototype.addEnemy=function(){var e=new EnemyUI;this.monk;1==Helpers.getRandomNum(0,1)?e.x=AlignHelpers.stageWidth:e.x-=e.width,e.y=Helpers.getRandomNum(0,AlignHelpers.stageHeight-e.height),e.visible=!0,this.addChild(e),this.enemys.push(e),this.enemyHit(e)},t.prototype.addEnemyAction=function(){var t=this,n=new egret.Timer(20,0),i=AlignHelpers.stageHeight+AlignHelpers.stageWidth,r=4;n.addEventListener(egret.TimerEvent.TIMER,function(){t.enemys.forEach(function(n){var o=t.monk.x-n.x,s=t.monk.y-n.y,a=Math.sqrt(o*o+s*s);if(350>a){var l=i/(1+Math.abs(s/o));t.monk.x<n.x&&(l=-l);var h=i/(1+Math.abs(o/s));t.monk.y<n.y&&(h=-h),egret.Tween.get(n).call(function(){n.slip(o,s)}).to({x:n.x+l,y:n.y+h},2500).call(function(){e.prototype.removeChild.call(t,n)}),t.enemys.splice(t.enemys.indexOf(n),1)}else(o>r||-r>o)&&(n.x+=t.monk.x>n.x?r:-r),(s>r||-r>s)&&(n.y+=t.monk.y>n.y?r:-r)})},this),this.timers.push(n),n.start()},t.prototype.addEnemyTimer=function(){var e=this,t=new egret.Timer(100,0);t.addEventListener(egret.TimerEvent.TIMER,function(){e.haveAddEnemyTask||0!=e.enemys.length||(e.haveAddEnemyTask=!0,egret.Tween.get(t).wait(2500).call(function(){var t=0;e.passTime<25?t=Helpers.getRandomNum(2,3):e.passTime>=25&&e.passTime<50?t=Helpers.getRandomNum(3,4):e.passTime>50&&(t=Helpers.getRandomNum(4,5));for(var n=0;t>n;n++)e.addEnemy();e.haveAddEnemyTask=!1}))},this),this.timers.push(t),t.start()},t.prototype.enemyHit=function(e){var t=this,n=new egret.Timer(10,0);n.addEventListener(egret.TimerEvent.TIMER,function(){var n=t.monk,i=e.hitTestPoint(n.x+n.width/2,n.y+n.height/2);if(i&&!t.gameIsOver){t.gameIsOver=!0,t.timers.forEach(function(e){e.stop()});var r=new GameOverEvent(GameOverEvent.NAME);r.time=t.passTime,t.dispatchEvent(r),t.monk.visible=!1}},this),this.timers.push(n),n.start()},t}(egret.Sprite);__reflect(GameUI.prototype,"GameUI");var HelpUI=function(e){function t(){var t=e.call(this)||this,n=RESHelpers.createShape(0,0,AlignHelpers.stageWidth,AlignHelpers.stageHeight,0,.8);RESHelpers.addToParent(t,n);var i=RESHelpers.createImg("rules_bg@2x_png");return RESHelpers.addToParent(t,i,Align.center,AlignContainer.stage),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEvent(new WindowCloseEvent(WindowCloseEvent.NAME))},t),t}return __extends(t,e),t}(egret.Sprite);__reflect(HelpUI.prototype,"HelpUI");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=720,this.textField.height=1155,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var MonkUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){var e=RESHelpers.createImg("monk_png");RESHelpers.addToParent(this,e);var t=RESHelpers.createImg("monk2_png");RESHelpers.addToParent(this,t),t.visible=!1;var n=new egret.Timer(100,0);n.addEventListener(egret.TimerEvent.TIMER,function(){e.visible=!e.visible,t.visible=!t.visible},this),n.start()},t}(egret.Sprite);__reflect(MonkUI.prototype,"MonkUI");var WelcomeUI=function(e){function t(t){var n=e.call(this)||this;return n.music=t,n.createView(),n}return __extends(t,e),t.prototype.createView=function(){this.addBg(),this.addBeginBtn(),this.addCardBtn(),this.addHelpBtn()},t.prototype.addBg=function(){var e=RESHelpers.createImg("bg_png",AlignHelpers.stageWidth);RESHelpers.addToParent(this,e)},t.prototype.addBeginBtn=function(){var e=this.beginBtn=RESHelpers.createImg("begin_btn_png");RESHelpers.addToParent(this,e,Align.centerX,null,function(){e.y=AlignHelpers.stageHeight+e.height,egret.Tween.get(e).to({y:e.y-420},1e3,egret.Ease.circOut)})},t.prototype.addHelpBtn=function(){var t=this,n=RESHelpers.createImg("home-jinnang@2x_png");RESHelpers.addToParent(this,n,Align.right,null,function(){n.y+=100,n.x+=30,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,t.helpBtnTimer=new egret.Timer(3e3,0),egret.Tween.get(n).to({width:n.width+15,height:n.height+15},1500).to({width:n.width,height:n.height},1500),t.helpBtnTimer.addEventListener(egret.TimerEvent.TIMER,function(){egret.Tween.get(n).to({width:n.width+15,height:n.height+15},1500).to({width:n.width,height:n.height},1500)},t),t.helpBtnTimer.start(),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var n=new HelpUI;RESHelpers.addToParent(t,n),n.addEventListener(WindowCloseEvent.NAME,function(){e.prototype.removeChild.call(t,n)},t)},t)})},t.prototype.addCardBtn=function(){var e=this.cardBtn=RESHelpers.createImg("card_btn_png");RESHelpers.addToParent(this,e,Align.centerX,null,function(){e.y=AlignHelpers.stageHeight+e.height,egret.Tween.get(e).to({y:e.y-300},1e3,egret.Ease.circOut)}),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)},t.prototype.enableBeginGameTap=function(){var e=this,t=this.beginBtn;t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){egret.Tween.get(e.beginBtn).to({y:e.beginBtn.y+420},500,egret.Ease.circIn),egret.Tween.get(e.cardBtn).to({y:e.cardBtn.y+300},1e3,egret.Ease.cubicOut).call(function(){e.helpBtnTimer.stop(),e.dispatchEvent(new WindowCloseEvent(WindowCloseEvent.NAME))}),e.music.isFirst&&e.music.play()},this)},t}(egret.Sprite);__reflect(WelcomeUI.prototype,"WelcomeUI");